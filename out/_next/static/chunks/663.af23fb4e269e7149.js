(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663,992,558],{54877:function(e,r,t){"use strict";t.r(r),t.d(r,{PhantomInjectedProvider:function(){return I},SlopeInjectedProxyProvider:function(){return C},SolanaPrivateKeyProvider:function(){return z},SolanaWallet:function(){return D},SolflareInjectedProvider:function(){return K},SolletInjectedProvider:function(){return k},TorusInjectedProvider:function(){return M}});var n=t(4942),s=t(22782),a=t(95844),i=t(16843),o=t(68531),c=t(77191),d=t.n(c),u=t(79826),g=t(12912),h=t(50108),p=t.n(h),l=t(48764).Buffer;function m(e){return(r,t,n,s)=>"solana_chainId"===r.method?(t.result=e,s()):n()}function v(e){return(r,t,n,s)=>"solana_provider_config"===r.method?(t.result=e,s()):n()}function y(e){const{chainId:r}=e;return(0,a.UZ)([m(r),v(e)])}function w(e){let{getAccounts:r}=e;return(0,a.Pk)((async(e,t,n)=>{const{method:s}=e;if("getAccounts"!==s)return n();if(!r)throw new Error("WalletMiddleware - opts.getAccounts not provided");const a=await r(e);t.result=a}))}function f(e){let{requestAccounts:r}=e;return(0,a.Pk)((async(e,t,n)=>{const{method:s}=e;if("requestAccounts"!==s)return n();if(!r)throw new Error("WalletMiddleware - opts.requestAccounts not provided");const a=await r(e);t.result=a}))}function P(e,r){return(0,a.Pk)((async(t,n,s)=>{const{method:a}=t;if(a!==e)return s();if(!r)throw new Error(`WalletMiddleware - ${e} not provided`);const i=await r(t);n.result=i}))}function b(e){const{getAccounts:r,requestAccounts:t,signTransaction:n,signAndSendTransaction:s,signAllTransactions:i,signMessage:o,getPrivateKey:c,getSecretKey:d}=e;return(0,a.UZ)([f({requestAccounts:t}),w({getAccounts:r}),P("signTransaction",n),P("signAndSendTransaction",s),P("signAllTransactions",i),P("signMessage",o),P("solanaPrivateKey",c),P("solanaSecretKey",d)])}function E(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function O(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?E(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class A extends o.Zk{constructor(e){let{config:r,state:t}=e;super({config:{chainConfig:O(O({},r.chainConfig),{},{chainNamespace:i.EN.SOLANA})},state:t})}async switchChain(e){return Promise.resolve()}async setupProvider(e){const r=new a.eI,t=b(this.getProviderHandlers(e));r.push(t);const n=y(this.config.chainConfig);r.push(n);const i=this.getInjectedProviderProxy(e);i&&r.push(i);const o=(0,s.Xj)(r);this.updateProviderEngineProxy(o),await this.lookupNetwork()}async lookupNetwork(){const{chainConfig:e}=this.config;return this.update({chainId:e.chainId}),e.chainId||""}getInjectedProviderProxy(e){}}const j=e=>({requestAccounts:async()=>e.publicKey?[d().encode(e.publicKey.toBytes())]:[],getAccounts:async()=>e.publicKey?[d().encode(e.publicKey.toBytes())]:[],getPrivateKey:async()=>{throw u.ethErrors.rpc.methodNotSupported()},getSecretKey:async()=>{throw u.ethErrors.rpc.methodNotSupported()},signTransaction:async r=>await e.signTransaction(r.params.message),signMessage:async r=>(await e.signMessage(r.params.message,r.params.display)).signature,signAllTransactions:async r=>{var t,n;if(null===(t=r.params)||void 0===t||!t.message||null===(n=r.params)||void 0===n||!n.message.length)throw u.ethErrors.rpc.invalidParams("message");return await e.signAllTransactions(r.params.message)},signAndSendTransaction:async r=>({signature:(await e.signAndSendTransaction(r.params.message)).signature})});function S(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function T(e){return(0,a.Pk)((async(r,t,s)=>{const a=await e.request(function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?S(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},r));t.result=a}))}class I extends A{getProviderHandlers(e){return j(e)}getInjectedProviderProxy(e){return T(e)}}class C extends A{getProviderHandlers(e){return((e,r)=>({requestAccounts:async()=>{const{data:r}=await e.connect();return[r.publicKey]},getAccounts:async()=>{const{data:r}=await e.connect();return[r.publicKey]},getPrivateKey:async()=>{throw u.ethErrors.rpc.methodNotSupported()},getSecretKey:async()=>{throw u.ethErrors.rpc.methodNotSupported()},signTransaction:async r=>{const t=r.params.message;if(!t)throw u.ethErrors.rpc.invalidRequest({message:"Invalid transaction message"});const{data:n}=await e.signTransaction(d().encode(t.serializeMessage()));if(!n.publicKey||!n.signature)throw new Error("Invalid signature from slope wallet");const s=new g.nh(n.publicKey),a=d().decode(n.signature);return t.addSignature(s,a),t},signMessage:async r=>{const t=await e.signMessage(r.params.message);return d().decode(t.data.signature)},signAndSendTransaction:async t=>{const n=r();if(!n)throw u.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const s=t.params.message;if(!s)throw u.ethErrors.rpc.invalidRequest({message:"Invalid transaction message"});const{data:a}=await e.signTransaction(d().encode(s.serializeMessage()));if(!a.publicKey||!a.signature)throw new Error("Invalid signature from slope wallet");const i=new g.nh(a.publicKey),o=d().decode(a.signature);s.addSignature(i,o);const c=await n.request({method:"solana_provider_config",params:[]}),h=new g.ew(c.rpcTarget);return{signature:await h.sendRawTransaction(s.serialize())}},signAllTransactions:async r=>{var t,n,s;if(null===(t=r.params)||void 0===t||!t.message||null===(n=r.params)||void 0===n||!n.message.length)throw u.ethErrors.rpc.invalidParams("message");const a=r.params.message,{length:i}=a,o=[];for(let e=0;e<i;e++)o.push(d().encode(r.params.message[e].serializeMessage()));const{msg:c,data:h}=await e.signAllTransactions(o);if(!h.publicKey||(null===(s=h.signatures)||void 0===s?void 0:s.length)!==i)throw new Error(c);const p=new g.nh(h.publicKey);for(let e=0;e<i;e++){const r=d().decode(h.signatures[e]);a[e].addSignature(p,r)}return a}}))(e,this.getProviderEngineProxy.bind(this))}}class K extends A{getProviderHandlers(e){return((e,r)=>{const t=j(e);return t.signAndSendTransaction=async t=>{const n=r();if(!n)throw u.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const s=await e.signTransaction(t.params.message),a=await n.request({method:"solana_provider_config",params:[]}),i=new g.ew(a.rpcTarget);return{signature:await i.sendRawTransaction(s.serialize())}},t})(e,this.getProviderEngineProxy.bind(this))}}class k extends A{getProviderHandlers(e){return((e,r)=>{const t=j(e);return t.signMessage=async r=>{const{signature:t}=await e.sign(r.params.message,"utf8");return t},t.signAndSendTransaction=async t=>{const n=r();if(!n)throw u.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const s=await e.signTransaction(t.params.message),a=await n.request({method:"solana_provider_config",params:[]}),i=new g.ew(a.rpcTarget);return{signature:await i.sendRawTransaction(s.serialize())}},t})(e,this.getProviderEngineProxy.bind(this))}}function q(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function x(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?q(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class M extends o.Zk{constructor(e){let{config:r,state:t}=e;super({config:{chainConfig:x(x({},r.chainConfig),{},{chainNamespace:i.EN.SOLANA})},state:t})}async switchChain(e){return Promise.resolve()}async setupProvider(e){this.handleInjectedProviderUpdate(e),await this.setupEngine(e)}async lookupNetwork(){if(!this.provider)throw u.ethErrors.provider.custom({message:"Torus solana provider is not initialized",code:4902});const{chainId:e}=this.config.chainConfig,r=await this.provider.request({method:"solana_chainId"}),t=(0,i.H2)(r.toString())?r:`0x${parseInt(r,10).toString(16)}`;if(e!==t)throw i.Ty.rpcConnectionError(`Invalid network, net_version is: ${t}, expected: ${e}`);return this.update({chainId:t}),this.provider.emit("connect",{chainId:this.state.chainId}),this.provider.emit("chainChanged",this.state.chainId),this.state.chainId}async setupEngine(e){const r=(e=>({requestAccounts:async()=>await e.request({method:"solana_requestAccounts",params:{}}),getAccounts:async()=>await e.request({method:"solana_requestAccounts",params:{}}),getPrivateKey:async()=>{throw u.ethErrors.rpc.methodNotSupported()},getSecretKey:async()=>{throw u.ethErrors.rpc.methodNotSupported()},signMessage:async r=>{var t;if(null===(t=r.params)||void 0===t||!t.message)throw u.ethErrors.rpc.invalidParams("message");return await e.signMessage(r.params.message)},signTransaction:async r=>{var t;if(null===(t=r.params)||void 0===t||!t.message)throw u.ethErrors.rpc.invalidParams("message");const n=r.params.message;return await e.signTransaction(n)},signAndSendTransaction:async r=>{var t;if(null===(t=r.params)||void 0===t||!t.message)throw u.ethErrors.rpc.invalidParams("message");const n=r.params.message;return{signature:await e.sendTransaction(n)}},signAllTransactions:async r=>{var t,n;if(null===(t=r.params)||void 0===t||!t.message||null===(n=r.params)||void 0===n||!n.message.length)throw u.ethErrors.rpc.invalidParams("message");const s=r.params.message;return await e.signAllTransactions(s)}}))(e),t=b(r),n=T(e),i=new a.eI;i.push(t),i.push(n);const o=(0,s.Xj)(i);this.updateProviderEngineProxy(o),await this.lookupNetwork()}async handleInjectedProviderUpdate(e){e.on("accountsChanged",(async e=>{this.provider.emit("accountsChanged",e)})),e.on("chainChanged",(async r=>{const t=(0,i.H2)(r)?r:`0x${parseInt(r,10).toString(16)}`;this.configure({chainConfig:x(x({},this.config.chainConfig),{},{chainId:t})}),await this.setupProvider(e)}))}}function N(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function _(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?N(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):N(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class z extends o.Zk{constructor(e){let{config:r,state:t}=e;super({config:{chainConfig:_(_({},r.chainConfig),{},{chainNamespace:i.EN.SOLANA})},state:t})}async enable(){if(!this.state.privateKey)throw u.ethErrors.provider.custom({message:"Private key is not found in state, plz pass it in constructor state param",code:4902});return await this.setupProvider(this.state.privateKey),this._providerEngineProxy.request({method:"eth_accounts"})}async setupProvider(e){const r=await async function(e){let{privKey:r,getProviderEngineProxy:t}=e;if("string"!==typeof r)throw i.Ty.invalidParams("privKey must be a string");const n=g.RG.fromSecretKey(l.from(r,"hex"));return{requestAccounts:async()=>[n.publicKey.toBase58()],getAccounts:async()=>[n.publicKey.toBase58()],getPrivateKey:async()=>r,getSecretKey:async()=>d().encode(n.secretKey),signTransaction:async e=>{var r;if(null===(r=e.params)||void 0===r||!r.message)throw u.ethErrors.rpc.invalidParams("message");const t=e.params.message;return t.partialSign(n),t},signMessage:async e=>{var r;if(null===(r=e.params)||void 0===r||!r.message)throw u.ethErrors.rpc.invalidParams("message");return p().sign.detached(e.params.message,n.secretKey)},signAndSendTransaction:async e=>{var r;if(null===(r=e.params)||void 0===r||!r.message)throw u.ethErrors.rpc.invalidParams("message");const s=t();if(!s)throw u.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const a=e.params.message;return a.sign(n),{signature:await s.request({method:"sendTransaction",params:[d().encode(a.serialize())]})}},signAllTransactions:async e=>{var r,t,s;if(null===(r=e.params)||void 0===r||!r.message||null===(t=e.params)||void 0===t||!t.message.length)throw u.ethErrors.rpc.invalidParams("message");const a=null===(s=e.params)||void 0===s?void 0:s.message;for(const i of a||[])i.partialSign(n);return a}}}({privKey:e,getProviderEngineProxy:this.getProviderEngineProxy.bind(this)}),t=b(r),n=new a.eI,{networkMiddleware:o}=function(e){const{rpcTarget:r}=e,t=(0,s.v$)({rpcTarget:r});return{networkMiddleware:(0,a.UZ)([y(e),t]),fetchMiddleware:t}}(this.config.chainConfig);n.push(this.getChainSwitchMiddleware()),n.push(this.getAccountMiddleware()),n.push(t),n.push(o);const c=(0,s.Xj)(n);this.updateProviderEngineProxy(c),await this.lookupNetwork()}async updateAccount(e){if(!this._providerEngineProxy)throw u.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});await this._providerEngineProxy.request({method:"solanaPrivateKey"})!==e.privateKey&&(await this.setupProvider(e.privateKey),this._providerEngineProxy.emit("accountsChanged",{accounts:await this._providerEngineProxy.request({method:"requestAccounts"})}))}async switchChain(e){if(!this._providerEngineProxy)throw u.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const r=this.getChainConfig(e.chainId);this.update({chainId:"loading"}),this.configure({chainConfig:r});const t=await this._providerEngineProxy.request({method:"solanaPrivateKey"});await this.setupProvider(t)}async lookupNetwork(){if(!this._providerEngineProxy)throw u.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const e=await this._providerEngineProxy.request({method:"getHealth",params:[]}),{chainConfig:r}=this.config;if("ok"!==e)throw i.Ty.rpcConnectionError(`Failed to lookup network for following rpc target: ${r.rpcTarget}`);return this.update({chainId:r.chainId}),this.state.chainId!==r.chainId&&(this.provider.emit("chainChanged",this.state.chainId),this.provider.emit("connect",{chainId:this.state.chainId})),this.state.chainId}getChainSwitchMiddleware(){return function(e){let{addNewChainConfig:r,switchSolanaChain:t}=e;return(0,a.UZ)([P("addSolanaChain",r),P("switchSolanaChain",t)])}({addNewChainConfig:async e=>{if(!e.params)throw u.ethErrors.rpc.invalidParams("Missing request params");const{chainId:r,chainName:t,rpcUrls:n,blockExplorerUrls:s,nativeCurrency:a}=e.params;if(!r)throw u.ethErrors.rpc.invalidParams("Missing chainId in chainParams");if(!n||0===n.length)throw u.ethErrors.rpc.invalidParams("Missing rpcUrls in chainParams");if(!a)throw u.ethErrors.rpc.invalidParams("Missing nativeCurrency in chainParams");this.addChain({chainNamespace:i.EN.SOLANA,chainId:r,ticker:(null===a||void 0===a?void 0:a.symbol)||"SOL",tickerName:(null===a||void 0===a?void 0:a.name)||"Solana",displayName:t,rpcTarget:n[0],blockExplorer:(null===s||void 0===s?void 0:s[0])||""})},switchSolanaChain:async e=>{if(!e.params)throw u.ethErrors.rpc.invalidParams("Missing request params");if(!e.params.chainId)throw u.ethErrors.rpc.invalidParams("Missing chainId");await this.switchChain(e.params)}})}getAccountMiddleware(){return function(e){let{updatePrivatekey:r}=e;return(0,a.UZ)([P("updateAccount",r)])}({updatePrivatekey:async e=>{if(!e.params)throw u.ethErrors.rpc.invalidParams("Missing request params");if(!e.params.privateKey)throw u.ethErrors.rpc.invalidParams("Missing privateKey");const{privateKey:r}=e.params;await this.updateAccount({privateKey:r})}})}}(0,n.Z)(z,"getProviderInstance",(async e=>{const r=new z({config:{chainConfig:e.chainConfig}});return await r.setupProvider(e.privKey),r}));class D{constructor(e){(0,n.Z)(this,"provider",void 0),this.provider=e}async requestAccounts(){return await this.provider.request({method:"requestAccounts",params:{}})}async signAndSendTransaction(e){const{signature:r}=await this.provider.request({method:"signAndSendTransaction",params:{message:e}});return{signature:r}}async signTransaction(e){return await this.provider.request({method:"signTransaction",params:{message:e}})}async signAllTransactions(e){return await this.provider.request({method:"signAllTransactions",params:{message:e}})}async signMessage(e){return await this.provider.request({method:"signMessage",params:{message:e}})}async request(e){return await this.provider.request(e)}}},7420:function(){},95856:function(){},78848:function(){}}]);